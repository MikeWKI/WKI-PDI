<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    <title>WKI Kenworth PDI App - Predelivery Inspection</title>
    
    <!-- React and dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 50%, #1a1a1a 100%);
            min-height: 100vh;
            position: relative;
            color-scheme: dark light; /* Supports both themes */
        }
        
        /* Dark theme support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #0a0a0a 0%, #1c1c1c 50%, #0a0a0a 100%);
            }
            
            .kenworth-card {
                background: #1e1e1e;
                border-color: #D32F2F;
                color: #e5e5e5;
            }
            
            .kenworth-form-input {
                background: #2a2a2a;
                border-color: #404040;
                color: #e5e5e5;
            }
            
            .kenworth-form-input:focus {
                border-color: #D32F2F;
                background: #333;
            }
            
            .kenworth-form-label {
                color: #e5e5e5;
            }
            
            /* Dark theme for inspection items */
            .inspection-item {
                background: #2a2a2a !important;
                border-color: #404040 !important;
                color: #e5e5e5 !important;
            }
            
            .inspection-item p {
                color: #e5e5e5 !important;
            }
            
            .inspection-item textarea {
                background: #333 !important;
                border-color: #555 !important;
                color: #e5e5e5 !important;
            }
            
            .inspection-item textarea:focus {
                border-color: #D32F2F !important;
                background: #3a3a3a !important;
            }
            
            /* Step indicator text */
            .step-text {
                color: #ccc !important;
            }
            
            /* Footer in dark mode */
            .proprietary-footer {
                background: rgba(211, 47, 47, 0.2) !important;
                color: #ccc !important;
            }
        }
        
        /* Loading spinner */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 50%, #1a1a1a 100%);
            z-index: 9999;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #D32F2F;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Mobile-friendly button styles */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            min-height: 44px; /* iOS touch target minimum */
            position: relative;
            overflow: hidden;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);
            color: white;
            border: 2px solid transparent;
        }
        
        .btn-primary:hover, .btn-primary:focus {
            background: linear-gradient(135deg, #E53935 0%, #C62828 100%);
            box-shadow: 0 8px 15px rgba(211, 47, 47, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 100%);
            color: white;
            border: 2px solid #D32F2F;
        }
        
        .btn-secondary:hover, .btn-secondary:focus {
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
        }
        
        .btn-disabled {
            background: #d1d5db;
            color: #9ca3af;
            cursor: not-allowed;
            border: 2px solid #d1d5db;
        }
        
        /* Kenworth themed components - mobile optimized */
        .kenworth-header {
            background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            border: 3px solid #1a1a1a;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .kenworth-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 2px solid #D32F2F;
            margin-bottom: 20px;
        }
        
        .kenworth-card-header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 100%);
            color: white;
            padding: 20px;
            border-radius: 13px 13px 0 0;
            font-size: 1.2rem;
            font-weight: 700;
            border-bottom: 3px solid #D32F2F;
        }
        
        .kenworth-form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px; /* Prevent zoom on iOS */
            transition: all 0.3s ease;
            background: white;
            min-height: 44px;
        }
        
        .kenworth-form-input:focus {
            outline: none;
            border-color: #D32F2F;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }
        
        .kenworth-form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        /* Mobile responsive grid */
        .responsive-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        @media (min-width: 640px) {
            .responsive-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .responsive-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Touch-friendly status buttons */
        .status-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .status-btn {
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid;
            cursor: pointer;
            min-height: 44px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .status-btn:active {
            transform: scale(0.95);
        }
        
        .status-btn.active {
            color: white;
        }
        
        .status-btn.inactive {
            background: white;
        }
        
        .status-no-issue.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
        }
        
        .status-no-issue.inactive {
            color: #10b981;
            border-color: #10b981;
        }
        
        .status-defective.active {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #ef4444;
        }
        
        .status-defective.inactive {
            color: #ef4444;
            border-color: #ef4444;
        }
        
        .status-repaired.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-color: #f59e0b;
        }
        
        .status-repaired.inactive {
            color: #f59e0b;
            border-color: #f59e0b;
        }
        
        /* Navigation improvements for mobile */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        @media (max-width: 640px) {
            .navigation {
                justify-content: center;
            }
            
            .btn {
                padding: 0.5rem 1rem;
                font-size: 14px;
            }
        }
        
        /* Progress indicator */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            margin: 16px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #D32F2F, #B71C1C);
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        /* Error handling styles */
        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
        }
        
        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
        }
    </style>
</head>
<body>
    <!-- Loading indicator -->
    <div id="loading" class="loading">
        <div style="text-align: center;">
            <div class="spinner"></div>
            <p style="color: white; margin-top: 20px; font-size: 18px;">Loading WKI Kenworth PDI App...</p>
            <p style="color: #ccc; margin-top: 10px; font-size: 14px;">Please wait while we initialize the application</p>
        </div>
    </div>
    
    <!-- Main app container -->
    <div id="root" style="display: none;"></div>

    <script>
        // Error handling
        window.addEventListener('error', function(e) {
            console.error('App Error:', e.error);
            const loading = document.getElementById('loading');
            if (loading && loading.style.display !== 'none') {
                loading.innerHTML = `
                    <div style="text-align: center; color: white;">
                        <h2 style="color: #ef4444;">⚠️ Loading Error</h2>
                        <p>There was an issue loading the application.</p>
                        <button onclick="location.reload()" style="padding: 12px 24px; background: #D32F2F; color: white; border: none; border-radius: 8px; margin-top: 16px; cursor: pointer;">
                            🔄 Reload App
                        </button>
                    </div>
                `;
            }
        });

        // Simple icon components using Unicode symbols
        const Icons = {
            Camera: () => React.createElement('span', null, '📷'),
            Check: () => React.createElement('span', null, '✅'),
            X: () => React.createElement('span', null, '❌'),
            Edit: () => React.createElement('span', null, '✏️'),
            Download: () => React.createElement('span', null, '💾'),
            ArrowRight: () => React.createElement('span', null, '➡️'),
            ArrowLeft: () => React.createElement('span', null, '⬅️'),
            Mail: () => React.createElement('span', null, '📧'),
            FileText: () => React.createElement('span', null, '📄')
        };

        const { useState, useRef, useEffect } = React;

        const PredeliveryInspectionApp = () => {
            const [isLoading, setIsLoading] = useState(true);
            const [currentSegment, setCurrentSegment] = useState(-1);
            const [headerInfo, setHeaderInfo] = useState({
                date: new Date().toISOString().split('T')[0],
                mileage: '',
                keyNumber: '',
                shopOrder: '',
                performingDir: '',
                dealer: 'Wichita Kenworth',
                chassis: '',
                model: '',
                stockNumber: ''
            });
            
            const [technicianInfo, setTechnicianInfo] = useState({
                name: '',
                signature: '',
                employeeId: ''
            });
            
            const [inspectionData, setInspectionData] = useState({});
            const [photos, setPhotos] = useState({});
            const [serialNumbers, setSerialNumbers] = useState({
                engine: '',
                transmission: '',
                steeringAxle: '',
                forwardRearAxle: '',
                pusherTag: '',
                rearRearAxle: '',
                dpf: ''
            });
            
            const fileInputRefs = useRef({});

            // Complete segments data from original
            const segments = [
                {
                    title: "Segment 1: Initial Setup",
                    instruction: "Hook up the battery charger before starting inspection.",
                    color: "segment-1",
                    tasks: [
                        {
                            category: "External Lighting",
                            items: [
                                "Snug tight roof mounted clearance light mounting screws",
                                "Check operation of all lights",
                                "Check Headlight adjustment"
                            ]
                        },
                        {
                            category: "Reseal Rear Axle Shafts",
                            items: [
                                "Visual Inspection for leaks or damage",
                                "Re-torque axle shaft nuts to 90 foot lbs for 5/8\" stud"
                            ]
                        },
                        {
                            category: "Mirrors",
                            items: [
                                "Adjust mirrors",
                                "Tighten West Coast Mirror bracket bolts",
                                "Tighten Aero mirror swivel brackets to 25 ft. lbs"
                            ]
                        },
                        {
                            category: "Connections in Electrical Boxes",
                            items: [
                                "Fuses seated",
                                "Relays seated"
                            ]
                        },
                        {
                            category: "Engine Clamps",
                            items: [
                                "Visual Inspection for leaks or damage",
                                "Tighten if needed do not over tighten"
                            ]
                        },
                        {
                            category: "Ride Height",
                            items: [
                                "Check Cab Ride Height",
                                "Check Rear Axle Ride Height"
                            ]
                        },
                        {
                            category: "Tires",
                            items: [
                                "Air up tires to recommended air pressure in door jam",
                                "Tire mounting beads installed with conformity to the wheel",
                                "Wheel is mounted in conformity to the hub"
                            ]
                        },
                        {
                            category: "Sleeper Auxiliary Units",
                            items: [
                                "Turn On and Operate Espar unit minimum 10 minutes",
                                "Standard HVAC controls and vents operational"
                            ]
                        },
                        {
                            category: "Install Air and Light Lines",
                            items: [
                                "Unwrap air & light cables",
                                "Secure to tender & retainer station"
                            ]
                        },
                        {
                            category: "Grease Chassis",
                            items: [
                                "Apply grease as needed to every grease point on the chassis (Reference appropriate Lube Chart)",
                                "Check power steering reservoir fluid level and leaks"
                            ]
                        },
                        {
                            category: "Fluid Levels",
                            items: [
                                "Check Fluid Level of trans., auxiliary trans., transfer case and axle(s). Tighten all drain and fill plugs",
                                "Check Coolant Levels",
                                "Check Wiper Fluid Levels",
                                "Check engine oil level and leaks refer to TIB 99-014"
                            ]
                        },
                        {
                            category: "Air System",
                            items: [
                                "Check the following for leaks: air tanks, air dryer, air lines and air compressor"
                            ]
                        },
                        {
                            category: "Inside of Vehicle",
                            items: [
                                "Operator's Manual & other required literature is in vehicle"
                            ]
                        }
                    ]
                },
                {
                    title: "Segment 2: Under Hood Inspection",
                    instruction: "",
                    color: "segment-2",
                    tasks: [
                        {
                            category: "Under Hood - Engine Off",
                            items: [
                                "Hood Safety Device is functional",
                                "Check Battery Cables for tightness, clearance and routing",
                                "Check wiring, hoses, fuel lines, oil lines, and air lines for routing clearance, and hold down"
                            ]
                        },
                        {
                            category: "Under Hood - Engine Running",
                            items: [
                                "Check for fluid leaks",
                                "Check for unusual noises and exhaust leaks"
                            ]
                        },
                        {
                            category: "Adjust Hood",
                            items: [
                                "Visual Inspection",
                                "Hood & cowl gap measures between 3/4\" and 1\" uniformly",
                                "Opens & closes smoothly with little effort. Grease cab mounted seats and slides"
                            ]
                        },
                        {
                            category: "Adjust Doors",
                            items: [
                                "Door closes firmly and securely to second latch",
                                "Cannot push in on the door from the outside near the door handle"
                            ]
                        },
                        {
                            category: "Windshield",
                            items: [
                                "Seal Windshield per guideline"
                            ]
                        },
                        {
                            category: "Emergency Equipment",
                            items: [
                                "Fire Extinguisher Mounted",
                                "Flare Kit Installed"
                            ]
                        }
                    ]
                },
                {
                    title: "Segment 3: Software Updates",
                    instruction: "Hook up the battery charger before starting inspection.",
                    color: "segment-3",
                    tasks: [
                        {
                            category: "Check Engine for Updates",
                            items: [
                                "Checked engine serial number on E-Portal for any updates or parameter changes",
                                "Update Engine Software to current version",
                                "Printed any Parameter Changes (Before & After)"
                            ]
                        },
                        {
                            category: "Check Transmission for Updates",
                            items: [
                                "Determine if present settings and programming is correct"
                            ]
                        },
                        {
                            category: "Check Bendix for Updates",
                            items: [
                                "Check the following: ABS, Traction Control, Stability Control, and Wingman"
                            ]
                        },
                        {
                            category: "Check Chassis for Updates",
                            items: [
                                "Check for version updates to Digital Display",
                                "Update NavPlus to newest version"
                            ]
                        }
                    ]
                },
                {
                    title: "Segment 4: Chassis & Underside",
                    instruction: "",
                    color: "segment-4",
                    tasks: [
                        {
                            category: "Chassis Alignment",
                            items: [
                                "Verify chassis alignment is within specifications and print before and after if adjustment is needed"
                            ]
                        },
                        {
                            category: "Underside",
                            items: [
                                "Check brake lines, fuel lines, and electrical wiring for routing, clearance, and hold-down",
                                "Visually Inspect Pitman arm and steering arms - connections and cotter pins",
                                "Check Non-LMS or Unitized Front Wheel Bearing Adjustment"
                            ]
                        }
                    ]
                },
                {
                    title: "Segment 5: Road Test",
                    instruction: "",
                    color: "segment-5",
                    tasks: [
                        {
                            category: "Road Test Vehicle",
                            items: [
                                "Seat Belts (seat & bunk)",
                                "Parking Brake Operation",
                                "Operation of neutral start switch - Automatic and automated manual transmissions",
                                "Service Brake, engine brake, and low air warning light/buzzer operation",
                                "Horn, windshield wipers, and washers - operation",
                                "Radio and operation of all accessories",
                                "Check fifth wheel release mechanism for proper operation",
                                "Clutch operation - Free-Play & Clutch Brake",
                                "All instruments and signals - operation (including ABS, SRS and engine lights)",
                                "Air leaks or noise around windshield",
                                "Air leak around doors"
                            ]
                        }
                    ]
                }
            ];

            // Initialize app
            useEffect(() => {
                const initApp = () => {
                    try {
                        setTimeout(() => {
                            setIsLoading(false);
                            const loading = document.getElementById('loading');
                            const root = document.getElementById('root');
                            if (loading) loading.style.display = 'none';
                            if (root) root.style.display = 'block';
                        }, 2000); // Longer timeout for mobile
                    } catch (error) {
                        console.error('Init error:', error);
                        setIsLoading(false);
                    }
                };
                
                // Check if we're on mobile and add extra delay
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                if (isMobile) {
                    setTimeout(initApp, 500);
                } else {
                    initApp();
                }
            }, []);

            const handleItemCheck = (segmentIndex, categoryIndex, itemIndex, status) => {
                const key = `${segmentIndex}-${categoryIndex}-${itemIndex}`;
                setInspectionData(prev => ({
                    ...prev,
                    [key]: { ...prev[key], status }
                }));
            };

            const handleCommentChange = (segmentIndex, categoryIndex, itemIndex, comment) => {
                const key = `${segmentIndex}-${categoryIndex}-${itemIndex}`;
                setInspectionData(prev => ({
                    ...prev,
                    [key]: { ...prev[key], comment }
                }));
            };

            const handlePhotoUpload = (segmentIndex, categoryIndex, itemIndex, event) => {
                const file = event.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        alert('Photo size too large. Please choose an image under 5MB.');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const key = `${segmentIndex}-${categoryIndex}-${itemIndex}`;
                        setPhotos(prev => ({
                            ...prev,
                            [key]: e.target.result
                        }));
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleSignature = () => {
                const signature = prompt("Enter your digital signature (e.g., 'John Smith - Certified Technician'):");
                if (signature) {
                    setTechnicianInfo(prev => ({ ...prev, signature }));
                }
            };

            const generateReport = () => {
                const report = {
                    headerInfo,
                    technicianInfo,
                    inspectionData,
                    photos,
                    serialNumbers,
                    timestamp: new Date().toISOString(),
                    segments
                };
                
                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `kenworth-pdi-${headerInfo.stockNumber || 'report'}-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const generatePDFReport = async () => {
                const totalItems = Object.keys(inspectionData).length;
                const noIssueCount = Object.values(inspectionData).filter(item => item.status === 'no-issue').length;
                const defectiveCount = Object.values(inspectionData).filter(item => item.status === 'defective').length;
                const repairedCount = Object.values(inspectionData).filter(item => item.status === 'repaired').length;
                const photoCount = Object.keys(photos).length;
                
                const currentDate = new Date().toLocaleDateString();
                const currentTime = new Date().toLocaleTimeString();
                
                const pdfWindow = window.open('', '_blank');
                
                let pdfContent = `
<!DOCTYPE html>
<html>
<head>
    <title>Kenworth PDI Report - ${headerInfo.stockNumber || 'Unknown'}</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            line-height: 1.4; 
            color: #333;
        }
        .header { 
            text-align: center; 
            background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            position: relative;
        }
        .header img {
            height: 70px;
            max-width: 300px;
            object-fit: contain;
            background-color: white;
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .header h1 { 
            font-size: 36px; 
            color: white; 
            margin: 8px 0 0 0;
            font-weight: bold;
            letter-spacing: 2px;
        }
        .fallback-logo {
            display: none;
        }
        .section { 
            margin-bottom: 20px; 
            page-break-inside: avoid;
        }
        .section-title { 
            background: #D32F2F; 
            color: white;
            padding: 10px; 
            font-weight: bold; 
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .vehicle-info { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin-bottom: 20px;
        }
        .info-item { 
            padding: 8px; 
            border-bottom: 1px solid #eee;
            background: #f9f9f9;
        }
        .info-label { 
            font-weight: bold; 
            display: inline-block; 
            width: 150px;
            color: #D32F2F;
        }
        .stats { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 15px; 
            margin: 20px 0;
        }
        .stat-item { 
            text-align: center; 
            padding: 15px; 
            border: 2px solid #D32F2F; 
            border-radius: 10px;
            background: #f9f9f9;
        }
        .stat-number { 
            font-size: 28px; 
            font-weight: bold; 
            margin-bottom: 5px;
        }
        .inspection-item { 
            margin-bottom: 15px; 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 8px;
            background: #fdfdfd;
        }
        .item-status { 
            display: inline-block; 
            padding: 4px 12px; 
            border-radius: 15px; 
            font-size: 12px; 
            font-weight: bold;
        }
        .status-no-issue { 
            background: #d4edda; 
            color: #155724;
        }
        .status-defective { 
            background: #f8d7da; 
            color: #721c24;
        }
        .status-repaired { 
            background: #fff3cd; 
            color: #856404;
        }
        .photo { 
            max-width: 250px; 
            max-height: 200px; 
            margin: 10px 0; 
            border: 2px solid #D32F2F; 
            border-radius: 8px;
        }
        @media print {
            body { margin: 0; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://www.kenworth.com/media/w4jnzm4t/kenworth_logo-header-new-012023.png" 
             alt="Kenworth Logo" 
             onerror="this.style.display='none'; document.querySelector('.fallback-logo').style.display='block';">
        <h1 class="fallback-logo">KENWORTH</h1>
        <h2>PDI Report</h2>
        <p>Predelivery Inspection Report • Generated: ${currentDate} at ${currentTime}</p>
    </div>

    <div class="section">
        <div class="section-title">VEHICLE INFORMATION</div>
        <div class="vehicle-info">
            <div class="info-item">
                <span class="info-label">Stock Number:</span>
                ${headerInfo.stockNumber || 'Not specified'}
            </div>
            <div class="info-item">
                <span class="info-label">Dealer:</span>
                ${headerInfo.dealer || 'Not specified'}
            </div>
            <div class="info-item">
                <span class="info-label">Chassis:</span>
                ${headerInfo.chassis || 'Not specified'}
            </div>
            <div class="info-item">
                <span class="info-label">Model:</span>
                ${headerInfo.model || 'Not specified'}
            </div>
            <div class="info-item">
                <span class="info-label">Mileage:</span>
                ${headerInfo.mileage || 'Not specified'}
            </div>
            <div class="info-item">
                <span class="info-label">Key Number:</span>
                ${headerInfo.keyNumber || 'Not specified'}
            </div>
            <div class="info-item">
                <span class="info-label">Shop Order:</span>
                ${headerInfo.shopOrder || 'Not specified'}
            </div>
            <div class="info-item">
                <span class="info-label">Performing DIR:</span>
                ${headerInfo.performingDir || 'Not specified'}
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">TECHNICIAN INFORMATION</div>
        <div class="info-item">
            <span class="info-label">Technician:</span>
            ${technicianInfo.name || 'Not specified'}
        </div>
        <div class="info-item">
            <span class="info-label">Employee ID:</span>
            ${technicianInfo.employeeId || 'Not specified'}
        </div>
        <div class="info-item">
            <span class="info-label">Digital Signature:</span>
            ${technicianInfo.signature || 'Not provided'}
        </div>
    </div>

    <div class="section">
        <div class="section-title">INSPECTION SUMMARY</div>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" style="color: #28a745;">${noIssueCount}</div>
                <div>No Issues</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" style="color: #dc3545;">${defectiveCount}</div>
                <div>Defective</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" style="color: #ffc107;">${repairedCount}</div>
                <div>Repaired</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" style="color: #007bff;">${photoCount}</div>
                <div>Photos</div>
            </div>
        </div>
    </div>
`;

                segments.forEach((segment, segmentIndex) => {
                    pdfContent += `<div class="section"><div class="section-title">${segment.title.toUpperCase()}</div>`;
                    
                    segment.tasks.forEach((task, categoryIndex) => {
                        pdfContent += `<h3>${task.category}</h3>`;
                        
                        task.items.forEach((item, itemIndex) => {
                            const key = `${segmentIndex}-${categoryIndex}-${itemIndex}`;
                            const itemData = inspectionData[key];
                            const photo = photos[key];
                            
                            if (itemData) {
                                const statusClass = itemData.status === 'no-issue' ? 'status-no-issue' : 
                                                   itemData.status === 'defective' ? 'status-defective' : 
                                                   itemData.status === 'repaired' ? 'status-repaired' : '';
                                
                                pdfContent += `
                                <div class="inspection-item">
                                    <div><strong>${item}</strong></div>
                                    ${itemData.status ? `<span class="item-status ${statusClass}">${itemData.status.toUpperCase().replace('-', ' ')}</span>` : ''}
                                    ${itemData.comment ? `<div style="margin-top: 8px;"><strong>Comment:</strong> ${itemData.comment}</div>` : ''}
                                    ${photo ? `<div><img src="${photo}" class="photo" alt="Inspection photo"></div>` : ''}
                                </div>`;
                            }
                        });
                    });
                    pdfContent += '</div>';
                });

                pdfContent += `
    <div class="section">
        <div class="section-title">MAJOR COMPONENT SERIAL NUMBERS</div>`;
                
                Object.entries(serialNumbers).forEach(([key, value]) => {
                    if (value) {
                        const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                        pdfContent += `
        <div class="info-item">
            <span class="info-label">${label}:</span>
            ${value}
        </div>`;
                    }
                });
                
                pdfContent += `
    </div>
    
    <div class="no-print" style="text-align: center; margin-top: 30px;">
        <button onclick="window.print()" style="padding: 12px 24px; background: #D32F2F; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px; font-size: 16px;">🖨️ Print/Save as PDF</button>
        <button onclick="window.close()" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">❌ Close</button>
    </div>
    
</body>
</html>`;

                pdfWindow.document.write(pdfContent);
                pdfWindow.document.close();
            };

            const generateEmailReport = () => {
                const totalItems = Object.keys(inspectionData).length;
                const noIssueCount = Object.values(inspectionData).filter(item => item.status === 'no-issue').length;
                const defectiveCount = Object.values(inspectionData).filter(item => item.status === 'defective').length;
                const repairedCount = Object.values(inspectionData).filter(item => item.status === 'repaired').length;
                const photoCount = Object.keys(photos).length;
                
                const currentDate = new Date().toLocaleDateString();
                const currentTime = new Date().toLocaleTimeString();
                
                const emailSubject = `Kenworth PDI Report - ${headerInfo.stockNumber || 'Unknown'} - ${currentDate}`;
                
                let inspectionDetails = '';
                segments.forEach((segment, segmentIndex) => {
                    inspectionDetails += `\n${segment.title.toUpperCase()}\n`;
                    inspectionDetails += '='.repeat(50) + '\n';
                    
                    segment.tasks.forEach((task, categoryIndex) => {
                        inspectionDetails += `\n${task.category}:\n`;
                        inspectionDetails += '-'.repeat(30) + '\n';
                        
                        task.items.forEach((item, itemIndex) => {
                            const key = `${segmentIndex}-${categoryIndex}-${itemIndex}`;
                            const itemData = inspectionData[key];
                            
                            if (itemData) {
                                const statusEmoji = itemData.status === 'no-issue' ? '✅' : 
                                                  itemData.status === 'defective' ? '❌' : 
                                                  itemData.status === 'repaired' ? '🔧' : '⚪';
                                
                                inspectionDetails += `${statusEmoji} ${item}\n`;
                                
                                if (itemData.status) {
                                    inspectionDetails += `   Status: ${itemData.status.toUpperCase().replace('-', ' ')}\n`;
                                }
                                
                                if (itemData.comment) {
                                    inspectionDetails += `   Comment: ${itemData.comment}\n`;
                                }
                                
                                if (photos[`${segmentIndex}-${categoryIndex}-${itemIndex}`]) {
                                    inspectionDetails += `   📸 Photo attached\n`;
                                }
                                
                                inspectionDetails += '\n';
                            }
                        });
                    });
                });
                
                const emailBody = `
██╗  ██╗███████╗███╗   ██╗██╗    ██╗ ██████╗ ██████╗ ████████╗██╗  ██╗
██║ ██╔╝██╔════╝████╗  ██║██║    ██║██╔═══██╗██╔══██╗╚══██╔══╝██║  ██║
█████╔╝ █████╗  ██╔██╗ ██║██║ █╗ ██║██║   ██║██████╔╝   ██║   ███████║
██╔═██╗ ██╔══╝  ██║╚██╗██║██║███╗██║██║   ██║██╔══██╗   ██║   ██╔══██║
██║  ██╗███████╗██║ ╚████║╚███╔███╔╝╚██████╔╝██║  ██║   ██║   ██║  ██║
╚═╝  ╚═╝╚══════╝╚═╝  ╚═══╝ ╚══╝╚══╝  ╚═════╝ ╚═╝  ╚═╝   ╚═╝   ╚═╝  ╚═╝

PREDELIVERY INSPECTION REPORT
${'='.repeat(80)}

INSPECTION SUMMARY
------------------
📅 Date: ${currentDate}
🕐 Time: ${currentTime}
👨‍🔧 Technician: ${technicianInfo.name || 'Not specified'}
🆔 Employee ID: ${technicianInfo.employeeId || 'Not specified'}

VEHICLE INFORMATION
-------------------
📋 Stock Number: ${headerInfo.stockNumber || 'Not specified'}
🏢 Dealer: ${headerInfo.dealer || 'Not specified'}
🚛 Chassis: ${headerInfo.chassis || 'Not specified'}
🚚 Model: ${headerInfo.model || 'Not specified'}
📏 Mileage: ${headerInfo.mileage || 'Not specified'}

INSPECTION STATISTICS
---------------------
📊 Total Items Inspected: ${totalItems}
✅ No Issues Found: ${noIssueCount}
❌ Defective Items: ${defectiveCount}
🔧 Items Repaired: ${repairedCount}
📸 Photos Captured: ${photoCount}

DETAILED INSPECTION RESULTS
${inspectionDetails}

${'='.repeat(80)}
🏭 Generated by WKI Kenworth PDI App • ${currentDate} at ${currentTime}
📧 Contact: WichitaServiceAdmin@WichitaKenworth.com
🌐 Professional Pre-Delivery Inspection System
`;

                const mailtoLink = `mailto:WichitaServiceAdmin@WichitaKenworth.com?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
                window.location.href = mailtoLink;
            };

            const handleNext = () => {
                if (currentSegment < segments.length + 2) {
                    setCurrentSegment(currentSegment + 1);
                }
            };

            const handlePrevious = () => {
                if (currentSegment > -1) {
                    setCurrentSegment(currentSegment - 1);
                }
            };

            const getDepartmentIcon = (segmentTitle) => {
                if (segmentTitle.includes('Initial')) return '🔧';
                if (segmentTitle.includes('Hood')) return '🚗';
                if (segmentTitle.includes('Software')) return '💻';
                if (segmentTitle.includes('Chassis')) return '🔩';
                if (segmentTitle.includes('Road')) return '🛣️';
                return '📋';
            };

            const renderVehicleForm = () => (
                React.createElement('div', { className: 'kenworth-card' },
                    React.createElement('div', { className: 'kenworth-card-header' }, 'Vehicle & Inspection Information'),
                    React.createElement('div', { style: { padding: '20px' } },
                        React.createElement('div', { className: 'responsive-grid' },
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Date'),
                                React.createElement('input', {
                                    type: 'date',
                                    value: headerInfo.date,
                                    onChange: (e) => setHeaderInfo(prev => ({ ...prev, date: e.target.value })),
                                    className: 'kenworth-form-input'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Stock Number'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: headerInfo.stockNumber,
                                    onChange: (e) => setHeaderInfo(prev => ({ ...prev, stockNumber: e.target.value })),
                                    className: 'kenworth-form-input',
                                    placeholder: 'Enter stock number'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Chassis'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: headerInfo.chassis,
                                    onChange: (e) => setHeaderInfo(prev => ({ ...prev, chassis: e.target.value })),
                                    className: 'kenworth-form-input',
                                    placeholder: 'Chassis number'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Model'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: headerInfo.model,
                                    onChange: (e) => setHeaderInfo(prev => ({ ...prev, model: e.target.value })),
                                    className: 'kenworth-form-input',
                                    placeholder: 'Vehicle model'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Mileage'),
                                React.createElement('input', {
                                    type: 'number',
                                    value: headerInfo.mileage,
                                    onChange: (e) => setHeaderInfo(prev => ({ ...prev, mileage: e.target.value })),
                                    className: 'kenworth-form-input',
                                    placeholder: 'Current mileage'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Key #'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: headerInfo.keyNumber,
                                    onChange: (e) => setHeaderInfo(prev => ({ ...prev, keyNumber: e.target.value })),
                                    className: 'kenworth-form-input',
                                    placeholder: 'Key number'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Shop Order #'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: headerInfo.shopOrder,
                                    onChange: (e) => setHeaderInfo(prev => ({ ...prev, shopOrder: e.target.value })),
                                    className: 'kenworth-form-input',
                                    placeholder: 'Shop order number'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Performing DIR'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: headerInfo.performingDir,
                                    onChange: (e) => setHeaderInfo(prev => ({ ...prev, performingDir: e.target.value })),
                                    className: 'kenworth-form-input',
                                    placeholder: 'Performing director'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Dealer'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: headerInfo.dealer,
                                    onChange: (e) => setHeaderInfo(prev => ({ ...prev, dealer: e.target.value })),
                                    className: 'kenworth-form-input',
                                    placeholder: 'Dealer name'
                                })
                            )
                        )
                    )
                )
            );

            const renderTechnicianForm = () => (
                React.createElement('div', { className: 'kenworth-card' },
                    React.createElement('div', { className: 'kenworth-card-header' }, 'Technician Information'),
                    React.createElement('div', { style: { padding: '20px' } },
                        React.createElement('div', { className: 'responsive-grid' },
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Technician Name'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: technicianInfo.name,
                                    onChange: (e) => setTechnicianInfo(prev => ({ ...prev, name: e.target.value })),
                                    className: 'kenworth-form-input',
                                    placeholder: 'Enter your name'
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Employee ID'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: technicianInfo.employeeId,
                                    onChange: (e) => setTechnicianInfo(prev => ({ ...prev, employeeId: e.target.value })),
                                    className: 'kenworth-form-input',
                                    placeholder: 'Employee ID'
                                })
                            ),
                            React.createElement('div', { style: { gridColumn: '1 / -1' } },
                                React.createElement('label', { className: 'kenworth-form-label' }, 'Digital Signature'),
                                React.createElement('button', {
                                    onClick: handleSignature,
                                    className: 'btn btn-primary',
                                    style: { marginBottom: '10px' }
                                },
                                    React.createElement(Icons.Edit),
                                    technicianInfo.signature ? ' Update Signature' : ' Add Signature'
                                ),
                                technicianInfo.signature && React.createElement('div', { 
                                    style: { 
                                        marginTop: '10px', 
                                        padding: '12px', 
                                        background: '#f0fdf4', 
                                        border: '2px solid #10b981', 
                                        borderRadius: '8px' 
                                    }
                                },
                                    React.createElement('p', { style: { fontSize: '14px', color: '#059669', margin: 0 } }, 
                                        '✓ Signature: ', technicianInfo.signature
                                    )
                                )
                            )
                        )
                    )
                )
            );

            const renderSerialNumbers = () => (
                React.createElement('div', { className: 'kenworth-card' },
                    React.createElement('div', { className: 'kenworth-card-header' }, 'Major Component Serial Numbers'),
                    React.createElement('div', { style: { padding: '20px' } },
                        React.createElement('p', { style: { fontSize: '14px', color: '#666', marginBottom: '16px' } }, 
                            'Required for extended warranties. Separate multiple axle serial numbers with commas.'
                        ),
                        React.createElement('div', { className: 'responsive-grid' },
                            Object.entries(serialNumbers).map(([key, value]) => {
                                const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                                return React.createElement('div', { key: key },
                                    React.createElement('label', { className: 'kenworth-form-label' }, label),
                                    React.createElement('input', {
                                        type: 'text',
                                        value: value,
                                        onChange: (e) => setSerialNumbers(prev => ({ ...prev, [key]: e.target.value })),
                                        className: 'kenworth-form-input',
                                        placeholder: `Enter ${label.toLowerCase()} serial number`
                                    })
                                );
                            })
                        )
                    )
                )
            );

            const renderInspectionItem = (item, segmentIndex, categoryIndex, itemIndex) => {
                const key = `${segmentIndex}-${categoryIndex}-${itemIndex}`;
                const itemData = inspectionData[key] || {};
                const photo = photos[key];

                return React.createElement('div', { 
                    key: itemIndex, 
                    className: 'inspection-item',
                    style: { 
                        border: '2px solid #e5e7eb', 
                        borderRadius: '12px', 
                        padding: '16px', 
                        marginBottom: '16px',
                        background: '#fafafa'
                    }
                },
                    React.createElement('p', { 
                        style: { 
                            fontSize: '14px', 
                            fontWeight: '600', 
                            marginBottom: '12px',
                            color: '#333'
                        }
                    }, item),
                    
                    React.createElement('div', { className: 'status-buttons' },
                        React.createElement('button', {
                            onClick: () => handleItemCheck(segmentIndex, categoryIndex, itemIndex, 'no-issue'),
                            className: `status-btn status-no-issue ${itemData.status === 'no-issue' ? 'active' : 'inactive'}`
                        },
                            React.createElement(Icons.Check),
                            ' No Issue'
                        ),
                        React.createElement('button', {
                            onClick: () => handleItemCheck(segmentIndex, categoryIndex, itemIndex, 'defective'),
                            className: `status-btn status-defective ${itemData.status === 'defective' ? 'active' : 'inactive'}`
                        },
                            React.createElement(Icons.X),
                            ' Issue Found'
                        ),
                        React.createElement('button', {
                            onClick: () => handleItemCheck(segmentIndex, categoryIndex, itemIndex, 'repaired'),
                            className: `status-btn status-repaired ${itemData.status === 'repaired' ? 'active' : 'inactive'}`
                        },
                            React.createElement(Icons.Edit),
                            ' Repaired'
                        )
                    ),

                    React.createElement('div', { className: 'responsive-grid', style: { marginTop: '12px' } },
                        React.createElement('div', null,
                            React.createElement('label', { className: 'kenworth-form-label' }, 'Comments'),
                            React.createElement('textarea', {
                                value: itemData.comment || '',
                                onChange: (e) => handleCommentChange(segmentIndex, categoryIndex, itemIndex, e.target.value),
                                style: {
                                    width: '100%',
                                    padding: '8px',
                                    border: '2px solid #e5e7eb',
                                    borderRadius: '8px',
                                    fontSize: '14px',
                                    minHeight: '60px',
                                    resize: 'vertical'
                                },
                                placeholder: 'Add any comments...'
                            })
                        ),
                        
                        React.createElement('div', null,
                            React.createElement('label', { className: 'kenworth-form-label' }, 'Photo'),
                            React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '8px', flexWrap: 'wrap' } },
                                React.createElement('input', {
                                    ref: ref => {
                                        if (ref) fileInputRefs.current[key] = ref;
                                    },
                                    type: 'file',
                                    accept: 'image/*',
                                    capture: 'environment',
                                    onChange: (e) => handlePhotoUpload(segmentIndex, categoryIndex, itemIndex, e),
                                    style: { display: 'none' }
                                }),
                                React.createElement('button', {
                                    onClick: () => fileInputRefs.current[key]?.click(),
                                    className: 'btn btn-secondary',
                                    style: { fontSize: '12px', padding: '8px 12px' }
                                },
                                    React.createElement(Icons.Camera),
                                    photo ? ' Change Photo' : ' Add Photo'
                                ),
                                photo && React.createElement('img', { 
                                    src: photo,
                                    alt: 'Inspection photo',
                                    style: {
                                        width: '50px',
                                        height: '50px',
                                        objectFit: 'cover',
                                        borderRadius: '8px',
                                        border: '2px solid #D32F2F'
                                    }
                                })
                            )
                        )
                    )
                );
            };

            const renderSegment = (segment, segmentIndex) => (
                React.createElement('div', { className: 'kenworth-card' },
                    React.createElement('div', { 
                        className: 'kenworth-card-header',
                        style: { 
                            background: `linear-gradient(135deg, ${getSegmentColor(segmentIndex)} 0%, ${getSegmentColorDark(segmentIndex)} 100%)`,
                            display: 'flex',
                            alignItems: 'center',
                            gap: '10px'
                        }
                    },
                        React.createElement('span', { style: { fontSize: '1.5rem' } }, getDepartmentIcon(segment.title)),
                        React.createElement('div', null,
                            React.createElement('h2', { style: { margin: 0, fontSize: '1.2rem' } }, segment.title),
                            segment.instruction && React.createElement('p', { 
                                style: { margin: '4px 0 0 0', fontSize: '12px', opacity: '0.9' } 
                            }, segment.instruction)
                        )
                    ),
                    React.createElement('div', { style: { padding: '20px' } },
                        segment.tasks.map((task, categoryIndex) => 
                            React.createElement('div', { key: categoryIndex, style: { marginBottom: '24px' } },
                                React.createElement('h3', { 
                                    style: { 
                                        background: 'linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%)',
                                        color: 'white',
                                        padding: '12px 16px',
                                        borderRadius: '8px',
                                        margin: '0 0 16px 0',
                                        fontSize: '1rem',
                                        fontWeight: '600'
                                    }
                                }, task.category),
                                task.items.map((item, itemIndex) =>
                                    renderInspectionItem(item, segmentIndex, categoryIndex, itemIndex)
                                )
                            )
                        )
                    )
                )
            );

            const getSegmentColor = (index) => {
                const colors = ['#10b981', '#8b5cf6', '#f59e0b', '#f97316', '#3b82f6'];
                return colors[index % colors.length];
            };

            const getSegmentColorDark = (index) => {
                const colors = ['#059669', '#7c3aed', '#d97706', '#ea580c', '#2563eb'];
                return colors[index % colors.length];
            };

            const renderSummary = () => {
                const totalItems = Object.keys(inspectionData).length;
                const noIssueCount = Object.values(inspectionData).filter(item => item.status === 'no-issue').length;
                const defectiveCount = Object.values(inspectionData).filter(item => item.status === 'defective').length;
                const repairedCount = Object.values(inspectionData).filter(item => item.status === 'repaired').length;
                const photoCount = Object.keys(photos).length;
                
                return React.createElement('div', { className: 'kenworth-card' },
                    React.createElement('div', { className: 'kenworth-card-header' }, 'Final Inspection Summary'),
                    React.createElement('div', { style: { padding: '20px' } },
                        React.createElement('div', { className: 'responsive-grid', style: { marginBottom: '20px' } },
                            React.createElement('div', { 
                                style: { 
                                    textAlign: 'center', 
                                    padding: '20px', 
                                    border: '2px solid #10b981', 
                                    borderRadius: '12px',
                                    background: '#f0fdf4'
                                }
                            },
                                React.createElement('div', { style: { fontSize: '2rem', fontWeight: 'bold', color: '#10b981' } }, noIssueCount),
                                React.createElement('div', { style: { fontSize: '0.9rem', color: '#059669' } }, 'No Issues')
                            ),
                            React.createElement('div', { 
                                style: { 
                                    textAlign: 'center', 
                                    padding: '20px', 
                                    border: '2px solid #ef4444', 
                                    borderRadius: '12px',
                                    background: '#fef2f2'
                                }
                            },
                                React.createElement('div', { style: { fontSize: '2rem', fontWeight: 'bold', color: '#ef4444' } }, defectiveCount),
                                React.createElement('div', { style: { fontSize: '0.9rem', color: '#dc2626' } }, 'Issues Found')
                            ),
                            React.createElement('div', { 
                                style: { 
                                    textAlign: 'center', 
                                    padding: '20px', 
                                    border: '2px solid #f59e0b', 
                                    borderRadius: '12px',
                                    background: '#fffbeb'
                                }
                            },
                                React.createElement('div', { style: { fontSize: '2rem', fontWeight: 'bold', color: '#f59e0b' } }, repairedCount),
                                React.createElement('div', { style: { fontSize: '0.9rem', color: '#d97706' } }, 'Repaired')
                            ),
                            React.createElement('div', { 
                                style: { 
                                    textAlign: 'center', 
                                    padding: '20px', 
                                    border: '2px solid #3b82f6', 
                                    borderRadius: '12px',
                                    background: '#eff6ff'
                                }
                            },
                                React.createElement('div', { style: { fontSize: '2rem', fontWeight: 'bold', color: '#3b82f6' } }, photoCount),
                                React.createElement('div', { style: { fontSize: '0.9rem', color: '#2563eb' } }, 'Photos')
                            )
                        ),
                        
                        React.createElement('div', { style: { textAlign: 'center', marginTop: '20px' } },
                            React.createElement('div', { style: { display: 'flex', flexWrap: 'wrap', gap: '12px', justifyContent: 'center' } },
                                React.createElement('button', {
                                    onClick: generatePDFReport,
                                    className: 'btn btn-primary'
                                },
                                    React.createElement(Icons.FileText),
                                    ' PDF Report'
                                ),
                                React.createElement('button', {
                                    onClick: generateEmailReport,
                                    className: 'btn btn-secondary'
                                },
                                    React.createElement(Icons.Mail),
                                    ' Email Report'
                                )
                            )
                        )
                    )
                );
            };

            const renderSegmentNavigation = () => (
                React.createElement('div', { 
                    style: { 
                        display: 'flex', 
                        justifyContent: 'center', 
                        gap: '8px', 
                        marginBottom: '20px', 
                        flexWrap: 'wrap' 
                    }
                },
                    segments.map((_, index) =>
                        React.createElement('button', {
                            key: index,
                            onClick: () => setCurrentSegment(index),
                            style: {
                                width: '40px',
                                height: '40px',
                                borderRadius: '50%',
                                border: '2px solid #D32F2F',
                                background: currentSegment === index ? 
                                    'linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%)' : 
                                    'white',
                                color: currentSegment === index ? 'white' : '#D32F2F',
                                fontWeight: 'bold',
                                cursor: 'pointer',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                transition: 'all 0.3s ease',
                                transform: currentSegment === index ? 'scale(1.1)' : 'scale(1)',
                                boxShadow: currentSegment === index ? '0 4px 12px rgba(211, 47, 47, 0.4)' : '0 2px 4px rgba(0,0,0,0.1)'
                            }
                        }, index + 1)
                    )
                )
            );

            const renderProgressBar = () => {
                const totalSteps = segments.length + 3; // +3 for vehicle info, technician info, and summary
                const currentStep = currentSegment === -1 ? 0 : 
                                   currentSegment === segments.length ? totalSteps - 2 :
                                   currentSegment === segments.length + 1 ? totalSteps - 1 :
                                   currentSegment + 1;
                const progress = (currentStep / (totalSteps - 1)) * 100;
                
                return React.createElement('div', { className: 'progress-bar' },
                    React.createElement('div', { 
                        className: 'progress-fill',
                        style: { width: `${Math.min(100, Math.max(0, progress))}%` }
                    })
                );
            };

            const getStepTitle = () => {
                if (currentSegment === -1) return 'Vehicle Information';
                if (currentSegment === segments.length) return 'Technician Information';
                if (currentSegment === segments.length + 1) return 'Serial Numbers';
                if (currentSegment === segments.length + 2) return 'Final Summary';
                return segments[currentSegment]?.title || 'Unknown Step';
            };

            const getStepNumber = () => {
                const totalSteps = segments.length + 4; // +4 for all forms and summary
                const currentStep = currentSegment === -1 ? 1 : 
                                   currentSegment === segments.length ? segments.length + 2 :
                                   currentSegment === segments.length + 1 ? segments.length + 3 :
                                   currentSegment === segments.length + 2 ? segments.length + 4 :
                                   currentSegment + 2;
                return { current: currentStep, total: totalSteps };
            };

            if (isLoading) {
                return null; // Loading screen is handled by HTML
            }

            const stepInfo = getStepNumber();

            return React.createElement('div', { style: { minHeight: '100vh', padding: '16px' } },
                React.createElement('div', { style: { maxWidth: '1000px', margin: '0 auto' } },
                    // Header
                    React.createElement('div', { className: 'kenworth-header', style: { textAlign: 'center' } },
                        React.createElement('div', { style: { display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '16px', marginBottom: '12px' } },
                            React.createElement('img', {
                                src: 'https://www.kenworth.com/media/w4jnzm4t/kenworth_logo-header-new-012023.png',
                                alt: 'Kenworth Logo',
                                style: {
                                    height: '60px',
                                    maxWidth: '250px',
                                    objectFit: 'contain',
                                    backgroundColor: 'white',
                                    padding: '8px 16px',
                                    borderRadius: '8px',
                                    boxShadow: '0 2px 8px rgba(0,0,0,0.2)'
                                },
                                onError: (e) => {
                                    e.target.style.display = 'none';
                                    e.target.nextSibling.style.display = 'inline';
                                }
                            }),
                            React.createElement('span', { 
                                style: { 
                                    fontSize: '1.8rem', 
                                    fontWeight: 'bold', 
                                    display: 'none' // Hidden fallback text
                                } 
                            }, 'WKI KENWORTH')
                        ),
                        React.createElement('h2', { style: { fontSize: '1.2rem', fontWeight: 'bold', margin: '0 0 8px 0' } }, 'PDI App'),
                        React.createElement('p', { style: { fontSize: '0.9rem', opacity: '0.9', margin: 0 } }, 'Digital Predelivery Inspection System')
                    ),
                    
                    // Progress bar
                    renderProgressBar(),
                    
                    // Step indicator
                    React.createElement('div', { style: { textAlign: 'center', marginBottom: '20px' } },
                        React.createElement('p', { 
                            className: 'step-text',
                            style: { color: '#666', fontSize: '14px', margin: '0 0 10px 0' } 
                        }, 
                            `Step ${stepInfo.current} of ${stepInfo.total}: ${getStepTitle()}`
                        ),
                        // Show segment navigation when in inspection segments
                        currentSegment >= 0 && currentSegment < segments.length && renderSegmentNavigation()
                    ),
                    
                    // Current step content
                    currentSegment === -1 && renderVehicleForm(),
                    currentSegment === segments.length && renderTechnicianForm(),
                    currentSegment === segments.length + 1 && renderSerialNumbers(),
                    currentSegment === segments.length + 2 && renderSummary(),
                    currentSegment >= 0 && currentSegment < segments.length && renderSegment(segments[currentSegment], currentSegment),
                    
                    // Navigation
                    React.createElement('div', { className: 'navigation' },
                        React.createElement('button', {
                            onClick: handlePrevious,
                            disabled: currentSegment === -1,
                            className: `btn ${currentSegment === -1 ? 'btn-disabled' : 'btn-secondary'}`
                        },
                            React.createElement(Icons.ArrowLeft),
                            ' Previous'
                        ),
                        
                        currentSegment < segments.length + 2 && React.createElement('button', {
                            onClick: handleNext,
                            className: 'btn btn-primary'
                        },
                            currentSegment === segments.length + 1 ? '✅ Finish' : 'Next ',
                            currentSegment === segments.length + 1 ? '' : React.createElement(Icons.ArrowRight)
                        )
                    ),
                    
                    // Proprietary Footer
                    React.createElement('div', { 
                        className: 'proprietary-footer',
                        style: { 
                            textAlign: 'center', 
                            marginTop: '40px', 
                            padding: '20px', 
                            borderTop: '2px solid #D32F2F',
                            background: 'rgba(211, 47, 47, 0.1)',
                            borderRadius: '10px',
                            color: '#666',
                            fontSize: '12px',
                            fontStyle: 'italic'
                        }
                    },
                        'WKI Operations Proprietary App – Unauthorized distribution or modification is prohibited.'
                    )
                )
            );
        };

        // Safer app initialization
        function initializeApp() {
            try {
                if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                    throw new Error('React libraries not loaded');
                }
                
                const rootElement = document.getElementById('root');
                if (!rootElement) {
                    throw new Error('Root element not found');
                }
                
                ReactDOM.render(React.createElement(PredeliveryInspectionApp), rootElement);
            } catch (error) {
                console.error('Failed to initialize app:', error);
                
                // Show error in loading screen
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.innerHTML = `
                        <div style="text-align: center; color: white;">
                            <h2 style="color: #ef4444;">⚠️ Application Error</h2>
                            <p>Failed to load the PDI application.</p>
                            <p style="font-size: 14px; color: #ccc;">Error: ${error.message}</p>
                            <button onclick="location.reload()" style="padding: 12px 24px; background: #D32F2F; color: white; border: none; border-radius: 8px; margin-top: 16px; cursor: pointer;">
                                🔄 Reload Application
                            </button>
                        </div>
                    `;
                }
            }
        }

        // Initialize when DOM and React are ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            // Check if React is loaded, if not wait a bit
            if (typeof React !== 'undefined') {
                initializeApp();
            } else {
                setTimeout(initializeApp, 1000);
            }
        }
    </script>
</body>
</html>
